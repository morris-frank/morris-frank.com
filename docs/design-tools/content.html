<style type="text/css">
    .hue-sliders {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 2rem;
        margin-bottom: 5rem;

        &>div {
            display: grid;
            grid-template-areas:
                "title number"
                "slider slider";
            grid-template-columns: 1fr max-content;
            gap: 1rem;

            label {
                grid-area: title;
                font-size: 1.2rem;
                font-weight: 600;
            }

            input[type="number"] {
                grid-area: number;
                width: 4rem;
                padding: 0.25rem;
                border: 1px solid #ccc;
                border-radius: 4px;
                font-size: 0.875rem;
            }

            input[type="range"] {
                grid-area: slider;
                -webkit-appearance: none;
                width: 100%;
                height: 20px;
                border-radius: 10px;
                background: linear-gradient(to right,
                        oklch(80% 0.24 0),
                        oklch(80% 0.24 60),
                        oklch(80% 0.24 120),
                        oklch(80% 0.24 180),
                        oklch(80% 0.24 240),
                        oklch(80% 0.24 300),
                        oklch(80% 0.24 360));
                outline: none;
                /* transition: opacity .2s; */
            }


            input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 13px;
                height: 13px;
                background: var(--black);
                border-radius: 50%;
                cursor: pointer;
                box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            }

            input[type="range"]::-moz-range-thumb {
                width: 13px;
                height: 13px;
                background: var(--black);
                cursor: pointer;
                box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            }
        }
    }

    pre {
        display: flex;
        justify-content: space-between;
        gap: 0.5rem;
        margin: 0;
        cursor: pointer;
        color: gray;
        mix-blend-mode: luminosity;
        padding: 0.25rem 0.5rem;
        border-radius: 2px;
        background: rgba(255, 255, 255, 0.2);
        font-size: 0.5rem;
        overflow: scroll;
        max-width: 100%;

        &:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        &::after {
            content: "ðŸ“‹";
            font-size: 0.875rem;
        }

        &.copied::after {
            content: "âœ“";
        }

    }

    #flutter-code {
        max-height: 15rem;
        overflow: scroll;
        margin: 0 auto;
    }

    #color-cards {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        grid-template-areas:
            "primary primary secondary secondary tertiary tertiary error error"
            "onPrimary onPrimary onSecondary onSecondary onTertiary onTertiary onError onError"
            "primaryContainer primaryContainer secondaryContainer secondaryContainer tertiaryContainer tertiaryContainer errorContainer errorContainer"
            "onPrimaryContainer onPrimaryContainer onSecondaryContainer onSecondaryContainer onTertiaryContainer onTertiaryContainer onErrorContainer onErrorContainer"
            "primaryFixed primaryFixedDim secondaryFixed secondaryFixedDim tertiaryFixed tertiaryFixedDim . ."
            "onPrimaryFixed onPrimaryFixed onSecondaryFixed onSecondaryFixed onTertiaryFixed onTertiaryFixed inverseSurface inverseSurface"
            "onPrimaryFixedVariant onPrimaryFixedVariant onSecondaryFixedVariant onSecondaryFixedVariant onTertiaryFixedVariant onTertiaryFixedVariant inverseOnSurface inverseOnSurface"
            "surfaceDim surfaceDim surface surface surfaceBright surfaceBright inversePrimary inversePrimary"
            "surfaceContainerLowest surfaceContainerLow surfaceContainer surfaceContainerHigh surfaceContainerHighest . . ."
            "onSurface onSurfaceVariant outline outlineVariant . . scrim shadow";
        gap: 0.4rem;



        section {
            padding: 1rem;
            border-radius: 8px;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-width: 0;
            overflow: scroll;

            h3 {
                margin: 0;
                font-size: 0.7rem;
                text-wrap: nowrap;
                color: gray;
                mix-blend-mode: luminosity;
            }



            &.primary {
                grid-area: primary;
            }

            &.onPrimary {
                grid-area: onPrimary;
            }

            &.primaryContainer {
                grid-area: primaryContainer;
            }

            &.onPrimaryContainer {
                grid-area: onPrimaryContainer;
            }

            &.primaryFixed {
                grid-area: primaryFixed;
            }

            &.primaryFixedDim {
                grid-area: primaryFixedDim;
            }

            &.onPrimaryFixed {
                grid-area: onPrimaryFixed;
            }

            &.onPrimaryFixedVariant {
                grid-area: onPrimaryFixedVariant;
            }

            &.inversePrimary {
                grid-area: inversePrimary;
            }

            &.secondary {
                grid-area: secondary;
            }

            &.onSecondary {
                grid-area: onSecondary;
            }

            &.secondaryContainer {
                grid-area: secondaryContainer;
            }

            &.onSecondaryContainer {
                grid-area: onSecondaryContainer;
            }

            &.secondaryFixed {
                grid-area: secondaryFixed;
            }

            &.secondaryFixedDim {
                grid-area: secondaryFixedDim;
            }

            &.onSecondaryFixed {
                grid-area: onSecondaryFixed;
            }

            &.onSecondaryFixedVariant {
                grid-area: onSecondaryFixedVariant;
            }

            &.tertiary {
                grid-area: tertiary;
            }

            &.onTertiary {
                grid-area: onTertiary;
            }

            &.tertiaryContainer {
                grid-area: tertiaryContainer;
            }

            &.onTertiaryContainer {
                grid-area: onTertiaryContainer;
            }

            &.tertiaryFixed {
                grid-area: tertiaryFixed;
            }

            &.tertiaryFixedDim {
                grid-area: tertiaryFixedDim;
            }

            &.onTertiaryFixed {
                grid-area: onTertiaryFixed;
            }

            &.onTertiaryFixedVariant {
                grid-area: onTertiaryFixedVariant;
            }

            &.error {
                grid-area: error;
            }

            &.onError {
                grid-area: onError;
            }

            &.errorContainer {
                grid-area: errorContainer;
            }

            &.onErrorContainer {
                grid-area: onErrorContainer;
            }

            &.surfaceDim {
                grid-area: surfaceDim;
            }

            &.surface {
                grid-area: surface;
            }

            &.surfaceBright {
                grid-area: surfaceBright;
            }

            &.surfaceContainerLowest {
                grid-area: surfaceContainerLowest;
            }

            &.surfaceContainerLow {
                grid-area: surfaceContainerLow;
            }

            &.surfaceContainer {
                grid-area: surfaceContainer;
            }

            &.surfaceContainerHigh {
                grid-area: surfaceContainerHigh;
            }

            &.surfaceContainerHighest {
                grid-area: surfaceContainerHighest;
            }

            &.inverseSurface {
                grid-area: inverseSurface;
            }

            &.inverseOnSurface {
                grid-area: inverseOnSurface;
            }

            &.onSurface {
                grid-area: onSurface;
            }

            &.onSurfaceVariant {
                grid-area: onSurfaceVariant;
            }

            &.outline {
                grid-area: outline;
            }

            &.outlineVariant {
                grid-area: outlineVariant;
            }

            &.scrim {
                grid-area: scrim;
            }

            &.shadow {
                grid-area: shadow;
            }

        }
    }
</style>

<h2>Material Design 3 Color Scheme Generator</h2>

<div class="hue-sliders">
    <div>
        <label>Primary</label>
        <input type="number" data-state="primary" min="0" max="360" oninput="setState('primary', this.value)">
        <input type="range" data-state="primary" min="0" max="360" oninput="setState('primary', this.value)">
    </div>
    <div>
        <label>Secondary</label>
        <input type="number" data-state="secondary" min="0" max="360" oninput="setState('secondary', this.value)">
        <input type="range" data-state="secondary" min="0" max="360" oninput="setState('secondary', this.value)">
    </div>
    <div>
        <label>Tertiary</label>
        <input type="number" data-state="tertiary" min="0" max="360" oninput="setState('tertiary', this.value)">
        <input type="range" data-state="tertiary" min="0" max="360" oninput="setState('tertiary', this.value)">
    </div>
</div>

<div id="color-cards"></div>

<h2>Flutter Code</h2>
<pre id="flutter-code">
    <code></code>
</pre>

<script>
    const getContrastColor = (l, c, h) => {
        const adjustedL = l > 50 ? Math.max(0, l - 20) : Math.min(100, l + 20);
        return { l: adjustedL, c, h };
    }

    const hueDiff = (h, diff) => {
        const newHue = h + diff;
        if (newHue > 360) return newHue - 360;
        if (newHue < 0) return newHue + 360;
        return newHue;
    }

    function oklchToHex(l, c, h) {
        // Normalize percentages to required ranges
        const normalizedL = l / 100; // Convert 0-100 to 0-1
        const normalizedC = (c / 100) * 0.4; // Convert 0-100 to 0-0.4

        // Convert OKLCH to OKLAB
        const a_oklab = normalizedC ? normalizedC * Math.cos((h / 180) * Math.PI) : 0;
        const b_oklab = normalizedC ? normalizedC * Math.sin((h / 180) * Math.PI) : 0;

        const L = Math.pow(
            normalizedL * 0.99999999845051981432 +
            0.39633779217376785678 * a_oklab +
            0.21580375806075880339 * b_oklab,
            3
        );
        const M = Math.pow(
            normalizedL * 1.0000000088817607767 -
            0.1055613423236563494 * a_oklab -
            0.063854174771705903402 * b_oklab,
            3
        );
        const S = Math.pow(
            normalizedL * 1.0000000546724109177 -
            0.089484182094965759684 * a_oklab -
            1.2914855378640917399 * b_oklab,
            3
        );

        const Rx = +4.076741661347994 * L -
            3.307711590408193 * M +
            0.230969928729428 * S;
        const Gx = -1.2684380040921763 * L +
            2.6097574006633715 * M -
            0.3413193963102197 * S;
        const Bx = -0.004196086541837188 * L -
            0.7034186144594493 * M +
            1.7076147009309444 * S;

        const lrgb_fn = (val = 0) => {
            const abs = Math.abs(val);
            if (abs > 0.0031308) {
                return (Math.sign(val) || 1) * (1.055 * Math.pow(abs, 1 / 2.4) - 0.055);
            }
            return val * 12.92;
        };

        const R = (lrgb_fn(Rx));
        const G = (lrgb_fn(Gx));
        const B = (lrgb_fn(Bx));

        const toHex = (n) => {
            const hex = Math.round(Math.max(0, Math.min(255, n * 255))).toString(16);
            return hex.length === 1 ? "0" + hex : hex;
        };

        return `#${toHex(R)}${toHex(G)}${toHex(B)}`;
    }

</script>

<script>
    const state = new Proxy({}, {
        set(target, prop, value) {
            target[prop] = value;

            document.querySelectorAll(`[data-state="${prop}"]`).forEach(element => {
                element.value = value;
            });

            createSchemes();

            return true;
        }
    });

    function setState(key, value) {
        if (typeof value === 'string') {
            value = parseInt(value);
            if (isNaN(value)) value = 0;
        }
        value = Math.max(0, Math.min(360, value));
        state[key] = value;
    }

    setState('primary', 53);
    setState('secondary', 106);
    setState('tertiary', 24);

    async function copyToClipboard(text) {
        try {
            await navigator.clipboard.writeText(text);
            return true;
        } catch (err) {
            console.error('Failed to copy:', err);
            return false;
        }
    }

    function createColorCard(name, l, c, h) {
        const card = document.createElement('section');

        const oklchStr = `oklch(${l}% ${c}% ${h})`;
        const hexStr = oklchToHex(l, c, h);
        const textColor = getContrastColor(l, c, h);

        document.querySelector('#flutter-code code').innerHTML += `  ${name}: Color(0xff${hexStr}),\n`;

        card.className = name;
        card.style.backgroundColor = oklchStr;
        card.style.color = textColor;

        card.innerHTML = `
            <h3>${name}</h3>
            <pre data-color="${hexStr}">${hexStr}</pre>
            <pre data-color="${oklchStr}">${oklchStr}</pre>
        `;

        document.querySelectorAll('pre').forEach(el => {
            el.addEventListener('click', async () => {
                const success = await copyToClipboard(el.dataset.color);
                if (success) {
                    el.classList.add('copied');
                    setTimeout(() => el.classList.remove('copied'), 1500);
                }
            });
        });

        document.getElementById('color-cards').appendChild(card);
    }


    function createSchemes() {
        const primary = state.primary;
        const secondary = state.secondary;
        const tertiary = state.tertiary;
        if (primary === null || primary === undefined ||
            secondary === null || secondary === undefined ||
            tertiary === null || tertiary === undefined) {
            return;
        }
        document.getElementById('color-cards').innerHTML = '';
        document.querySelector('#flutter-code code').innerHTML = 'import "package:flutter/material.dart";\n\n' +
            'const kLightScheme = ColorScheme(\n';

        createColorCard('surfaceTint', 74, 43, primary);
        createColorCard('primary', 74, 43, primary);
        createColorCard('onPrimary', 24, 0, hueDiff(primary, 90 - 53));
        createColorCard('primaryContainer', 81, 22, primary);
        createColorCard('onPrimaryContainer', 44, 29, hueDiff(primary, 50 - 53));
        createColorCard('primaryFixed', 81, 26, hueDiff(primary, 297 - 53));
        createColorCard('onPrimaryFixed', 22, 24, hueDiff(primary, 292 - 53));
        createColorCard('primaryFixedDim', 72, 26, hueDiff(primary, 297 - 53));
        createColorCard('onPrimaryFixedVariant', 35, 24, hueDiff(primary, 294 - 53));
        createColorCard('inversePrimary', 84, 23, hueDiff(primary, 298 - 53));

        createColorCard('secondary', 74, 38, secondary);
        createColorCard('onSecondary', 24, 0, hueDiff(secondary, 90 - 106));
        createColorCard('secondaryContainer', 95, 2, secondary);
        createColorCard('onSecondaryContainer', 24, 0, hueDiff(secondary, 90 - 106));
        createColorCard('secondaryFixed', 92, 9, hueDiff(secondary, 290 - 106));
        createColorCard('onSecondaryFixed', 23, 9, hueDiff(secondary, 280 - 106));
        createColorCard('secondaryFixedDim', 83, 8, hueDiff(secondary, 291 - 106));
        createColorCard('onSecondaryFixedVariant', 40, 8, hueDiff(secondary, 282 - 106));


        createColorCard('tertiary', 74, 38, tertiary);
        createColorCard('onTertiary', 24, 0, hueDiff(tertiary, 90 - 24));
        createColorCard('tertiaryContainer', 82, 26, tertiary);
        createColorCard('onTertiaryContainer', 44, 29, hueDiff(tertiary, 24 - 24));
        createColorCard('tertiaryFixed', 85, 34, hueDiff(tertiary, 326 - 24));
        createColorCard('onTertiaryFixed', 27, 32, hueDiff(tertiary, 322 - 24));
        createColorCard('tertiaryFixedDim', 76, 33, hueDiff(tertiary, 325 - 24));
        createColorCard('onTertiaryFixedVariant', 40, 32, hueDiff(tertiary, 323 - 24));

        createColorCard('error', 51, 48, 33);
        createColorCard('onError', 100, 0, 68);
        createColorCard('errorContainer', 92, 11, 25);
        createColorCard('onErrorContainer', 41, 28, 28);

        createColorCard('surface', 100, 0, 90);
        createColorCard('onSurface', 24, 0, 90);
        createColorCard('onSurfaceVariant', 82, 1, 78);
        createColorCard('surfaceDim', 89, 3, 85);
        createColorCard('surfaceBright', 100, 0, 90);
        createColorCard('surfaceContainerLowest', 99, 3, 78);
        createColorCard('surfaceContainerLow', 97, 3, 74);
        createColorCard('surfaceContainer', 97, 1, 91);
        createColorCard('surfaceContainerHigh', 92, 4, 85);
        createColorCard('surfaceContainerHighest', 94, 1, 74);
        createColorCard('inverseSurface', 31, 3, 303);
        createColorCard('outline', 80, 6, 101);
        createColorCard('outlineVariant', 83, 5, 101);
        createColorCard('shadow', 0, 0, 0);
        createColorCard('scrim', 0, 0, 0);

        document.querySelector('#flutter-code code').innerHTML += ');';
    }
</script>